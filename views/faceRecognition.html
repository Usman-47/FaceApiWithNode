<!DOCTYPE html>
<html>
<head>
  <script src="face-api.js"></script>
  <script src="js/commons.js"></script>
  <script src="js/faceDetectionControls.js"></script>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="sideBar.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.css">
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
  <!-- <script>
    $( document ).ready(function(){
      $(".button-collapse").sideNav();
    });
  </script>
 -->

</head>
<body>
  <!-- <div id="navbar"></div> -->
   <!-- <div class="progress" id="loader">
      <div class="indeterminate"></div>
    </div> -->
   
     <!-- Loader -->
    <div class="preloader-background"  id="loader"> 
      <div class="preloader-wrapper big active">
            <div class="spinner-layer spinner-blue">
              <div class="circle-clipper left">
                <div class="circle"></div>
              </div><div class="gap-patch">
                <div class="circle"></div>
              </div><div class="circle-clipper right">
                <div class="circle"></div>
              </div>
            </div>
      
            <div class="spinner-layer spinner-red">
              <div class="circle-clipper left">
                <div class="circle"></div>
              </div><div class="gap-patch">
                <div class="circle"></div>
              </div><div class="circle-clipper right">
                <div class="circle"></div>
              </div>
            </div>
      
            <div class="spinner-layer spinner-yellow">
              <div class="circle-clipper left">
                <div class="circle"></div>
              </div><div class="gap-patch">
                <div class="circle"></div>
              </div><div class="circle-clipper right">
                <div class="circle"></div>
              </div>
            </div>
      
            <div class="spinner-layer spinner-green">
              <div class="circle-clipper left">
                <div class="circle"></div>
              </div><div class="gap-patch">
                <div class="circle"></div>
              </div><div class="circle-clipper right">
                <div class="circle"></div>
              </div>
            </div>
          </div>
        <p class="blinking" ></p>
      </div> 
     <!-- Loader ends-->

  <!-- Row Starts -->
  <nav style="position: fixed;z-index: 13;"  >

 <div class="nav-wrapper" >
        
        <ul id="nav-mobile" class="right hide-on-med-and-down"  >
          <li ><a href="sass.html">Home</a></li>
          <li ><a href="sass.html">Face Filters</a></li>
          <li><a href="badges.html">Webcam</a></li>
          <li><a href="collapsible.html">BBT</a></li>
        </ul>
        <!-- <a href="#" data-activates="slide-out" class="right button-collapse "><img src="menu_icon.png" width="60px" /></a> -->
      </div>
    </nav>

    <div class="row"  >
    <!-- ul col starts -->
    <div class="col m3 " >
      <ul id="slide-out" class="side-nav fixed main-side;" style="background-color: white;border-right: 0.5px solid #a7adb0;z-index: 10;width:240px;">
        <li class="user-li"><div class="user-view">
          <div class="background">
          </div>
        <li class="lone">
          <a href="faceMenu.html"><i class="fas fa-home my-icon" ></i><span style="margin-left: 50px;">Home</span></a></li>
          <div class="divider"></div>
        </li>
        <li class="lone subheader center-align">Menu</li>
        
        <li class="dropchange">
          <ul class="collapsible" >
            <li>
              <div class="collapsible-header head">
              <p ><i class="fas fa-id-card my-icon"></i><span class="sidebar-subheading">Face Filters</span></p>
              </div>
              <div class="collapsible-body drop-body">
                <ul class="drop-body"  >              
                  <li><a class="waves-effect dropdownMargin" href="faceDetection.html"><span >Face Detection</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="faceLandmarkDetection.html"><span >Face Landmark Detection</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="faceExpressionRecognition.html"><span>Face Expression Recognition</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="faceRecognition.html"><span >Face Recognition</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="faceExtraction.html"><span>Face Extraction</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="videoFaceTracking.html"><span >Video Face Tracking</span></a></li>
                </ul>
              </div>
            </li>
          </ul>
        </li>
        <li class="dropchange">
          <ul class="collapsible">
            <li>
              <div class="collapsible-header head">
                <p ><i class="fas fa-shopping-basket my-icon"></i><span class="sidebar-subheading">BBT filters</span></p>
              </div>
              <div class="collapsible-body">
                <ul>
                  <li><a class="waves-effect dropdownMargin" href="bbtFaceMatching.html"><span>BBT Face Similarity</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="bbtFaceMatching.html"><span>BBT Face Matching</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="bbtFaceRecognition.html"><span>BBT Face Recognition</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="bbtFaceLandmarkDetection.html"><span>Batch Face Landmark Detection</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="batchFaceRecognition.html"><span>Batch Face Recognition</span></a></li>
    
                </ul>
              </div>
            </li>
          </ul>
        </li>
        <li class="dropchange">
          <ul class="collapsible">
            <li>
              <div class="collapsible-header head">
                <p ><i class="fas fa-briefcase my-icon"></i><span class="sidebar-subheading">Webcam filters  </span</p>
                </div>
              <div class="collapsible-body">
                <ul>
                  <li><a class="waves-effect dropdownMargin" href="webcamFaceDetection.html"><span >Webcam Face Detection</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="webcamFaceLandmarkDetection.html"><span>Webcam Face Landmark Detection</span></a></li>
                  <li><a class="waves-effect dropdownMargin" href="webcamFaceExpressionRecognition.html"><span>Webcam Face Expression Recognition</span></a></li>
                </ul>
              </div>
            </li>
          </ul>
        </li>
        
        </ul> 
    </div>
    <!-- ul col ends -->  

  <!-- cards col starts -->
  <div class="col m7 s11 " style="margin-top:80px">
<nav >
  <div class="nav-wrapper" style="margin-right: 100px;">
    <div class="col s12">
      <a href="#!" class="breadcrumb">Face Filter ></a>
      <a href="#!" >Face Recognition </a>
 </div>
 </div>
 </nav>
    <div class="card "   style=" padding: 10px; border-radius: 5px;box-shadow: 0 0 5px rgb(0 0 0 / 35%);" >    
      <img id="refImg"  class="imgresponsive" src="" style="border-radius: 10px;"  />
          <canvas id="refImgOverlay" class="overlay"   />  
      <h6 class="blue-text card-heading"> Reference Image </h6>      
      
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status" id="loader">
        <span class="sr-only blue-text center-content" >Loading...</span>
      </div>
      <div  >                   
          <img id="refImg" src=""  class="imgresponsive" src="" style="border-radius: 10px;"  />
          <canvas id="refImgOverlay" class="overlay"/>               
      </div>
    </div>
  
    <div class="card "    style=" padding: 20px; border-radius: 5px;">
      <div class="row" >
        <div class="col m12 s12">
        <!-- image_selection_control -->
        
          <label for="refImgUrlInput">Get image from URL:</label>
          <input id="refImgUrlInput" type="text" class="bold">
        
        <div class="col m6 ">
          <label class="btn blue darken-1">
            <span for="refImgUploadInput">Upload Image</span>
            <input id="refImgUploadInput" type="file" class="bold" onchange="uploadRefImage()" style="width: 200px;display: none;" accept=".jpg, .jpeg, .png">
          </label> 
          <button
            class="waves-effect waves-light btn blue  darken-1"
            onclick="loadRefImageFromUrl()"
          >
            Ok
          </button> 
        </div>          
      </div>       
      </div>  
      </div>
        <!-- image_selection_control -->
    <div class="row" >

      <h6 class="blue-text card-heading"> Query Image: </h6>

      <div style="position: relative" class="margin">
        <img id="queryImg" src="" style="max-width: 800px;" />
        <canvas id="queryImgOverlay" class="overlay"/>
      </div>
    </div>

    <div class="row" style="margin-top: -30px;">
      <div class="col m6 s12">
           <div >
             <label for="queryImgUrlInput">Get image from URL:</label>
             <input id="queryImgUrlInput" type="text" class="bold">
           </div>
            </div>
        <div class="col m6 s12 btn-margin" >

        <div class="col m6 ">
          <label class="btn blue darken-1">
            <span for="queryImgUploadInput">Upload Image</span>
            <input id="queryImgUploadInput" type="file" class="bold" onchange="uploadQueryImage()" style="width: 200px;display: none;" accept=".jpg, .jpeg, .png">
          </label>
          <button
          class="waves-effect waves-light btn blue darken-1"
          onclick="loadQueryImageFromUrl()"
          >
            Ok
          </button>  
        </div>

       
       
        <!-- image_selection_control -->

      </div>

      <div class="row">
        <!-- face_detector_selection_control -->
        <div id="face_detector_selection_control" class="input-field col m12 s12" >
          <select id="selectFaceDetector">
            <option value="ssd_mobilenetv1">SSD Mobilenet V1</option>
            <option value="tiny_face_detector">Tiny Face Detector</option>
          </select>
          <label>Select Face Detector</label>
        </div>
        <!-- face_detector_selection_control -->

        <!-- ssd_mobilenetv1_controls -->
        <span id="ssd_mobilenetv1_controls">
          <div class="row ">
            <div class="col m12 s12">
              <label for="minConfidence">Min Confidence:</label>
              <input disabled value="0.5" id="minConfidence" type="text" class="bold">
            </div>
      <div class="col m6 s6">

            <button
            class="waves-effect waves-light btn small blue darken-1"
              onclick="onDecreaseMinConfidence()"
            >
              <i class="material-icons left">-</i>
            </button>
            <button
            class="waves-effect waves-light btn small blue darken-1"
              onclick="onIncreaseMinConfidence()"
            >
              <i class="material-icons left">+</i>
            </button>
          </div>
          <div class="col m6 s6" >
          
        
          </div>
          </div>        
        </span>
        <!-- ssd_mobilenetv1_controls -->

        <!-- tiny_face_detector_controls -->
        <span id="tiny_face_detector_controls">
          <div class="row ">
            <div class="col m6 s6 input-field">
              <select id="inputSize">
                <option value="" disabled selected>Input Size:</option>
                <option value="160">160 x 160</option>
                <option value="224">224 x 224</option>
                <option value="320">320 x 320</option>
                <option value="416">416 x 416</option>
                <option value="512">512 x 512</option>
                <option value="608">608 x 608</option>
              </select>
              <label>Input Size</label>
            </div>
            <div class="col m6 s6">
              <label for="scoreThreshold">Score Threshold:</label>
              <input disabled value="0.5" id="scoreThreshold" type="text" class="bold">
            </div>
            <div class="col m12 s12" >
              <button
              class="waves-effect waves-light btn small blue darken-1"
              onclick="onDecreaseScoreThreshold()"
              >
                <i class="material-icons left">-</i>
              </button>
              <button
              class="waves-effect waves-light btn small blue darken-1"
              onclick="onIncreaseScoreThreshold()"
              >
                <i class="material-icons left">+</i>
              </button>
            </div>
          </div>
        </span>
        </div>
        <!-- tiny_face_detector_controls -->

      </div>
     
     
      </div>
  
  </div>
  
    <!-- Row ends  -->
  </body>

  <script>
    let faceMatcher = null

    async function uploadRefImage(e) {
      const imgFile = $('#refImgUploadInput').get(0).files[0]
      const img = await faceapi.bufferToImage(imgFile)
      $('#refImg').get(0).src = img.src
      updateReferenceImageResults()
    }

    async function loadRefImageFromUrl(url) {
      const img = await requestExternalImage($('#refImgUrlInput').val())
      $('#refImg').get(0).src = img.src
      updateReferenceImageResults()
    }

    async function uploadQueryImage(e) {
      const imgFile = $('#queryImgUploadInput').get(0).files[0]
      const img = await faceapi.bufferToImage(imgFile)
      $('#queryImg').get(0).src = img.src
      updateQueryImageResults()
    }

    async function loadQueryImageFromUrl(url) {
      const img = await requestExternalImage($('#queryImgUrlInput').val())
      $('#queryImg').get(0).src = img.src
      updateQueryImageResults()
    }

    async function updateReferenceImageResults() {
      const inputImgEl = $('#refImg').get(0)
      const canvas = $('#refImgOverlay').get(0)

      const fullFaceDescriptions = await faceapi
        .detectAllFaces(inputImgEl, getFaceDetectorOptions())
        .withFaceLandmarks()
        .withFaceDescriptors()

      if (!fullFaceDescriptions.length) {
        return
      }

      // create FaceMatcher with automatically assigned labels
      // from the detection results for the reference image
      faceMatcher = new faceapi.FaceMatcher(fullFaceDescriptions)

      faceapi.matchDimensions(canvas, inputImgEl)
      // resize detection and landmarks in case displayed image is smaller than
      // original size
      const resizedResults = faceapi.resizeResults(fullFaceDescriptions, inputImgEl)
      // draw boxes with the corresponding label as text
      const labels = faceMatcher.labeledDescriptors
        .map(ld => ld.label)
      resizedResults.forEach(({ detection, descriptor }) => {
        const label = faceMatcher.findBestMatch(descriptor).toString()
        const options = { label }
        const drawBox = new faceapi.draw.DrawBox(detection.box, options)
        drawBox.draw(canvas)
      })
    }

    async function updateQueryImageResults() {
      if (!faceMatcher) {
        return
      }

      const inputImgEl = $('#queryImg').get(0)
      const canvas = $('#queryImgOverlay').get(0)

      const results = await faceapi
        .detectAllFaces(inputImgEl, getFaceDetectorOptions())
        .withFaceLandmarks()
        .withFaceDescriptors()

      faceapi.matchDimensions(canvas, inputImgEl)
      // resize detection and landmarks in case displayed image is smaller than
      // original size
      const resizedResults = faceapi.resizeResults(results, inputImgEl)

      resizedResults.forEach(({ detection, descriptor }) => {
        const label = faceMatcher.findBestMatch(descriptor).toString()
        const options = { label }
        const drawBox = new faceapi.draw.DrawBox(detection.box, options)
        drawBox.draw(canvas)
      })
    }

    async function updateResults() {
      await updateReferenceImageResults()
      await updateQueryImageResults()
    }

    async function run() {
      // load face detection, face landmark model and face recognition models
      await changeFaceDetector(selectedFaceDetector)
      await faceapi.loadFaceLandmarkModel('/')
      await faceapi.loadFaceRecognitionModel('/')
    }

    $(document).ready(function() {
      // renderNavBar('#navbar', 'face_recognition')
      initFaceDetectionControls()
      run()
    })
  </script>
</body>
</html>